<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>Love Notes - Web</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
            background: radial-gradient(circle at top, #FFF7FF 0%, #F3F8FF 40%, #E8F1FF 100%);
            overflow: hidden;
        }

        .app-bg {
            position: fixed;
            inset: 0;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.96),
                rgba(249, 237, 255, 0.99)
            );
            z-index: 0;
        }

        .app {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 24px;
            z-index: 1;
        }

        .notes-layer {
            position: relative;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* 背景发光爱心（只做视觉，不影响便签坐标） */
        .heart-glow {
            position: absolute;
            left: 50%;
            top: 50%;
            width: min(70vw, 620px);
            height: min(60vh, 520px);
            transform: translate(-50%, -55%);
            pointer-events: none;
            opacity: 0.75;
            filter: blur(18px);
            background:
                radial-gradient(circle at 30% 25%, rgba(255, 192, 203, 0.36), transparent 55%),
                radial-gradient(circle at 70% 20%, rgba(255, 182, 222, 0.4), transparent 58%),
                radial-gradient(circle at 50% 78%, rgba(255, 153, 204, 0.46), transparent 55%);
            animation: glow-pulse 6s ease-in-out infinite;
        }

        .note {
            position: absolute;
            width: 260px;
            height: 160px;
            border-radius: 18px;
            padding: 0;
            background: transparent;
            box-shadow: 0 16px 40px rgba(154, 119, 193, 0.18);
            transform: translate3d(0, 24px, 0) scale(0.9) rotate(0deg);
            opacity: 0;
            transition:
                opacity 0.6s ease-out,
                transform 0.9s cubic-bezier(0.19, 1, 0.22, 1),
                left 0.55s ease-in-out,
                top 0.55s ease-in-out;
        }

        .note.visible {
            opacity: 1;
            transform: translate3d(0, 0, 0) scale(1) rotate(var(--note-rotate, -3deg));
        }

        .note-inner {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 18px;
            padding: 10px 14px;
            background: linear-gradient(
                145deg,
                rgba(255, 255, 255, 0.96),
                rgba(255, 249, 255, 0.99)
            );
            box-shadow:
                0 0 0 1px rgba(255, 255, 255, 0.85),
                0 18px 35px rgba(148, 123, 187, 0.24);
            border: 1px solid rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(6px);
        }

        .note-title {
            font-size: 11px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: #9c7ac4;
            opacity: 0.9;
        }

        .note-body {
            margin-top: 8px;
            font-size: 16px;
            color: #5e4768;
            line-height: 1.6;
            word-break: break-all;
        }

        .note-inner:hover {
            box-shadow:
                0 0 0 1px rgba(255, 255, 255, 0.95),
                0 22px 45px rgba(148, 123, 187, 0.35);
            transform: translate3d(0, -4px, 0);
        }

        /* 开始按钮面板 */
        .start-panel {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background:
                radial-gradient(circle at center, rgba(255, 255, 255, 0.85), rgba(244, 228, 255, 0.92));
            z-index: 2;
            transition: opacity 0.6s ease-out;
        }

        .start-panel.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .start-card {
            padding: 26px 38px 28px;
            border-radius: 26px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.96), rgba(255, 240, 250, 0.98));
            box-shadow:
                0 0 0 1px rgba(255, 255, 255, 0.9),
                0 24px 60px rgba(148, 123, 187, 0.35);
            text-align: center;
            max-width: 380px;
            backdrop-filter: blur(16px);
            animation: float-up 6s ease-in-out infinite;
        }

        .start-title {
            font-size: 20px;
            background: linear-gradient(120deg, #ff6ba2, #ff9ad6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            letter-spacing: 0.12em;
        }

        .start-sub {
            font-size: 14px;
            color: #7f678f;
            margin-bottom: 18px;
        }

        .start-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 26px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #ff7bab, #ffb3d4);
            color: #ffffff;
            font-size: 14px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 10px 28px rgba(255, 122, 171, 0.6);
        }

        .start-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 34px rgba(255, 122, 171, 0.7);
        }

        .start-btn::before {
            content: '❤';
            font-size: 14px;
            margin-right: 6px;
        }

        @keyframes glow-pulse {
            0%, 100% {
                opacity: 0.65;
                transform: translate(-50%, -55%) scale(1);
            }
            50% {
                opacity: 0.9;
                transform: translate(-50%, -55%) scale(1.04);
            }
        }

        @keyframes float-up {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-6px);
            }
        }
    </style>
</head>
<body>
    <div class="app-bg"></div>
    <div class="app">
        <div class="heart-glow"></div>
        <div class="start-panel" id="start-panel">
            <div class="start-card">
                <div class="start-title">收一封小心意</div>
                <div class="start-sub">点一下，看看今天的便签都写了什么</div>
                <button class="start-btn" id="start-btn">打开便签</button>
            </div>
        </div>
        <div class="notes-layer" id="notes-layer"></div>
    </div>

    <script>
        (function () {
            const NOTE_WIDTH = 260;
            const NOTE_HEIGHT = 160;
            const NOTE_COUNT = 80;
            const CREATE_INTERVAL = 150; // 与 love_notes.py 默认 interval 对齐
            const HEART_DELAY_MS = 250;
            const NOTE_PADDING = 22;

            const COLORS = [
                '#FFEAF4',
                '#F5E9FF',
                '#EAF6FF',
                '#EFFFF6',
                '#FFF5E9',
                '#FDEBFF',
                '#F3F8FF',
                '#FFEFF5',
                '#E9FFF5',
                '#FFF9FF',
            ];

            const MESSAGES = [
                '今天也要元气满满呀',
                '多晒晒太阳多微笑',
                '多喝热水照顾好自己',
                '要记得好好吃饭',
                '偶尔也要休息一下',
                '你真的很了不起',
                '慢慢来一切都会好',
                '给自己一个温柔的拥抱',
                '保持热爱奔赴山海',
                '小确幸正在路上啦',
                '不许熬夜要早睡',
                '早点休息做个好梦',
                '好心情要常在',
                '要对自己温柔一点',
                '相信好事正在发生',
                '愿你所想皆成真',
                '记得抬头看看天空',
                '笑一笑什么都会过去',
                '世界偷偷准备着惊喜',
                '今天也要好好生活',
            ];

            function pickMessages(count) {
                const result = [];
                for (let index = 0; index < count; index += 1) {
                    const message = MESSAGES[Math.floor(Math.random() * MESSAGES.length)];
                    result.push(message);
                }
                return result;
            }

            // 等价于 love_notes.py 的 generate_positions
            function generateScatterPositions(count, width, height) {
                const positions = [];
                if (count <= 0) return positions;

                const cols = Math.max(1, Math.floor(width / (NOTE_WIDTH + 40)));
                const rows = Math.ceil(count / cols);

                const cellWidth = width / cols;
                const cellHeight = height / rows;

                for (let index = 0; index < count; index += 1) {
                    const col = index % cols;
                    const row = Math.floor(index / cols);

                    const jitterX = (cellWidth - NOTE_WIDTH) / 2;
                    const jitterY = (cellHeight - NOTE_HEIGHT) / 2;

                    let x = col * cellWidth + (Math.random() * 2 - 1) * jitterX + jitterX;
                    let y = row * cellHeight + (Math.random() * 2 - 1) * jitterY + jitterY;

                    x = Math.max(NOTE_PADDING, Math.min(x, width - NOTE_WIDTH - NOTE_PADDING));
                    y = Math.max(NOTE_PADDING, Math.min(y, height - NOTE_HEIGHT - NOTE_PADDING));

                    positions.push({ x, y });
                }

                // 打乱顺序
                for (let i = positions.length - 1; i > 0; i -= 1) {
                    const j = Math.floor(Math.random() * (i + 1));
                    const tmp = positions[i];
                    positions[i] = positions[j];
                    positions[j] = tmp;
                }

                return positions;
            }

            // 等价于 love_notes.py 的 generate_heart_positions
            function generateHeartPositions(count, width, height) {
                const positions = [];
                if (count <= 0) return positions;

                const usableWidth = width - 4 * NOTE_PADDING - NOTE_WIDTH;
                const usableHeight = height - 4 * NOTE_PADDING - NOTE_HEIGHT;

                const baseScale = Math.min(usableWidth / 34, usableHeight / 32);
                const clamped = Math.max(14, Math.min(baseScale, 36));

                // 再收窄一点、再拉高一点，让爱心更修长
                const scaleX = clamped * 0.95;
                const scaleY = clamped * 1.18;

                const offsetX = width / 2;
                const offsetY = height / 2 - 70;

                for (let index = 0; index < count; index += 1) {
                    const t = (index / count) * Math.PI * 2;

                    const xBase = 16 * Math.sin(t) ** 3;
                    const yBase =
                        13 * Math.cos(t)
                        - 5 * Math.cos(2 * t)
                        - 2 * Math.cos(3 * t)
                        - Math.cos(4 * t);

                    const radial = 0.94 + Math.random() * 0.08;
                    const x = xBase * radial;
                    const y = yBase * radial;

                    const xPos = offsetX + x * scaleX - NOTE_WIDTH / 2;
                    const yPos = offsetY - y * scaleY - NOTE_HEIGHT / 2;

                    positions.push({ x: xPos, y: yPos });
                }

                return positions;
            }

            function createWall() {
                const layer = document.getElementById('notes-layer');
                layer.innerHTML = '';

                const width = window.innerWidth;
                const height = window.innerHeight;

                const messages = pickMessages(NOTE_COUNT);
                const scatterPositions = generateScatterPositions(NOTE_COUNT, width, height);
                const heartPositions = generateHeartPositions(NOTE_COUNT, width, height);

                const notes = [];

                messages.forEach((text, index) => {
                    const delay = index * CREATE_INTERVAL;
                    setTimeout(() => {
                        const noteElement = document.createElement('div');
                        noteElement.className = 'note';
                        noteElement.style.left = `${scatterPositions[index].x}px`;
                        noteElement.style.top = `${scatterPositions[index].y}px`;

                        const rotate = (Math.random() * 14 - 7).toFixed(2);
                        noteElement.style.setProperty('--note-rotate', `${rotate}deg`);

                        const inner = document.createElement('div');
                        inner.className = 'note-inner';
                        inner.style.background = `linear-gradient(145deg, rgba(255,255,255,0.96), ${COLORS[index % COLORS.length]})`;

                        const title = document.createElement('div');
                        title.className = 'note-title';
                        title.textContent = 'LOVE NOTE';

                        const body = document.createElement('div');
                        body.className = 'note-body';
                        body.textContent = text;

                        inner.appendChild(title);
                        inner.appendChild(body);
                        noteElement.appendChild(inner);
                        layer.appendChild(noteElement);

                        requestAnimationFrame(() => {
                            noteElement.classList.add('visible');
                        });

                        notes.push({
                            el: noteElement,
                            target: heartPositions[index],
                        });
                    }, delay);
                });

                const mergeAt = NOTE_COUNT * CREATE_INTERVAL + HEART_DELAY_MS;
                setTimeout(() => {
                    notes.forEach((item, index) => {
                        const extraDelay = index * 12;
                        setTimeout(() => {
                            item.el.style.left = `${item.target.x}px`;
                            item.el.style.top = `${item.target.y}px`;
                            const softRotate = (Math.random() * 6 - 3).toFixed(2);
                            item.el.style.setProperty('--note-rotate', `${softRotate}deg`);
                        }, extraDelay);
                    });
                }, mergeAt);
            }

            function setupStartButton() {
                const startPanel = document.getElementById('start-panel');
                const startBtn = document.getElementById('start-btn');

                if (!startPanel || !startBtn) {
                    createWall();
                    window.addEventListener('resize', () => createWall());
                    return;
                }

                startBtn.addEventListener('click', () => {
                    startPanel.classList.add('hidden');
                    createWall();
                    window.addEventListener('resize', () => createWall());
                });
            }

            window.addEventListener('load', setupStartButton);
        }());
    </script>
</body>
</html>
